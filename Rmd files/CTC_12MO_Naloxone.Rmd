---
title: "Naloxone12moCTC"
author: "Elizabeth Kinnard"
date: "7/6/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, eval=T, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=85),tidy=TRUE)
```

Open packages.
```{r}
library(base)
library(knitr)
library(dplyr)
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
```

Open working directory and load/label the data.
```{r}
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY

#load the data
df <- read.spss("CTC12month.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
```

Get variable labels.
```{r, echo=F, eval=F}
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)

#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
```

Subset the data to delete all rows that are entirely NA (since they didn't show up to 12 month visit).
```{r}
df <- df[rowSums(is.na(df)) < 600,] #rows reduced from N=984 to N=536 people

#EXAMPLES OF SUBSETTING
#df <- subset(df, SUMINJ>0)
#df <- subset(df, IJWOTH_3cat>0) 
```

Descriptives of overdose and naloxone variables.
```{r}
#ODP6M: Overdosed in the last 6 months
#In the last 6 months, have you overdosed?
tbl.ODP6M <- table(df$ODP6M, useNA = "ifany")
tbl.ODP6M
prop.table(tbl.ODP6M)

#ODTIMES: Times overdosed in the last 6 months
#How many times did you overdose in the last 6 months?
tbl.ODTIMES <- table(df$ODTIMES, useNA = "ifany")  
tbl.ODTIMES 
prop.table(tbl.ODTIMES)

#FENTOD: Number of fentanyl related overdoses
#In the last 6 months, when you overdosed, how many times had you been using Fentanyl 
#or drugs with Fentanyl in it?
tbl.FENTOD <- table(df$FENTOD, useNA = "ifany")  
tbl.FENTOD
prop.table(tbl.FENTOD)

#ODDRUG: Drugs used when overdosed the last time
#The last time you overdosed, what drug or drugs had you been using?  Check all that apply
table(df$ODDRUG, useNA = "ifany")    

table(df$ODDRUGA, useNA = "ifany") #Crack cocaine
table(df$ODDRUGB, useNA = "ifany") #Powder cocaine
table(df$ODDRUGC, useNA = "ifany") #Methamphetamine
table(df$ODDRUGD, useNA = "ifany") #Heroin (by itself)
table(df$ODDRUGE, useNA = "ifany") #Speedball (heroin mixed with cocaine or crack)
table(df$ODDRUGF, useNA = "ifany") #Goofball (heroin mixed with speed)
table(df$ODDRUGG, useNA = "ifany") #Non-opiate pain relievers (percocet, percodan, darvon)
table(df$ODDRUGH, useNA = "ifany") #Opiates (vicodin, oxycontin, dilaudid)
table(df$ODDRUGI, useNA = "ifany") #Tranquilizers (klonopin, xanax, valium, atavan)
table(df$ODDRUGJ, useNA = "ifany") #Sedatives (restoril, tuinal, phenobarbatal)
table(df$ODDRUGK, useNA = "ifany") #Stimulants (ritalin, aderall, methadrine, bezedrine)
table(df$ODDRUGL, useNA = "ifany") #Methadone
table(df$ODDRUGM, useNA = "ifany") #Alcohol
table(df$ODDRUGN, useNA = "ifany") #Fentanyl or drugs w/fentanyl

#WOD6M: Witnessed an overdose in the last 6 months
#In the last 6 months, have you witnessed a heroin or opiate overdose?
tbl.WOD6M <- table(df$WOD6M, useNA = "ifany")   
tbl.WOD6M
prop.table(tbl.WOD6M)

#WODX6M: Number of witnessed overdoses in the last 6 months
#In the last 6 months, how many heroin or opiate overdoses have you witnessed?
tbl.WODX6M <- table(df$WODX6M, useNA = "ifany")   
tbl.WODX6M
prop.table(tbl.WODX6M)

#NARCAN: More than one dose of narcan to revive person
#Of the overdoses you witnessed where naloxone was used, did any of them require more than
#one dose to revive the person to the best of your knowledge?
tbl.NARCAN <- table(df$NARCAN, useNA = "ifany")   
tbl.NARCAN 
prop.table(tbl.NARCAN)

#RIGID: Rigidty or seizures during the overdose
#During the overdose(s) that you witnessed, did any one of the victims have immediate body 
#rigidity or seizures?
tbl.RIGID <- table(df$RIGID, useNA = "ifany") 
tbl.RIGID 
prop.table(tbl.RIGID)

#IMMED: Any immediate overdoses
#Of the overdoses you witnessed, did any of the victims overdose immediately or shortly 
#after taking their shot?
tbl.IMMED <- table(df$IMMED, useNA = "ifany") 
tbl.IMMED 
prop.table(tbl.IMMED)

#USEDNAL: Times naloxone used by bystander to prevent overdose in the last 30 days
#In the last 6 months, how many of these witnessed overdoses did you or someone else 
#who was not an EMT or police officer use naloxone or narcan?
tbl.USEDNAL <- table(df$USEDNAL, useNA = "ifany") 
tbl.USEDNAL 
prop.table(tbl.USEDNAL)

#OD911: Number of witnessed od where 911 was called in the last 30 days
#In the last 6 months, how many of these witnessed overdoses did you or someone else call 911?
tbl.OD911 <- table(df$OD911, useNA = "ifany") 
tbl.OD911
prop.table(tbl.OD911)

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
tbl.ODTRAIN <- table(df$ODTRAIN, useNA = "ifany") 
tbl.ODTRAIN
prop.table(tbl.ODTRAIN)

#ODTBY: OD training from whom
#From whom did you receive overdose prevention training? 
table(df$ODTBY, useNA = "ifany") 

table(df$ODTBYA, useNA = "ifany") #Needle exchange
table(df$ODTBYB, useNA = "ifany") #Another drug user
table(df$ODTBYC, useNA = "ifany") #Another community member
table(df$ODTBYD, useNA = "ifany") #A family member
table(df$ODTBYE, useNA = "ifany") #Pharmacy
table(df$ODTBYF, useNA = "ifany") #Community clinic
table(df$ODTBYG, useNA = "ifany") #Hospital
table(df$ODTBYH, useNA = "ifany") #Jail or prison
table(df$ODTBYI, useNA = "ifany") #Other

#ODTOTH:Overdose training by other organization
#What is the other organization or entity that provided you with overdose training?
tbl.ODTOTH <- table(df$ODTOTH, useNA = "ifany") 
tbl.ODTOTH 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
tbl.NALEVER <- table(df$NALEVER, useNA = "ifany") 
tbl.NALEVER 
prop.table(tbl.NALEVER)

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
tbl.NAL6MOS <- table(df$NAL6MOS, useNA = "ifany")
tbl.NAL6MOS
prop.table(tbl.NAL6MOS)

#NAL6ORG: Naloxone from whom in the last 6 months
#From whom did you receive naloxone, narcan, intranasal narcan, and/or autoinjector/evzio in the last 6 months?  
table(df$NAL6ORG, useNA = "ifany") 

table(df$NAL6ORGA, useNA = "ifany") #Needle exchange
table(df$NAL6ORGB, useNA = "ifany") #Another drug user
table(df$NAL6ORGC, useNA = "ifany") #Another community member
table(df$NAL6ORGD, useNA = "ifany") #A family member
table(df$NAL6ORGE, useNA = "ifany") #Pharmacy
table(df$NAL6ORGF, useNA = "ifany") #Community clinic
table(df$NAL6ORGG, useNA = "ifany") #Hospital
table(df$NAL6ORGH, useNA = "ifany") #Jail or prison
table(df$NAL6ORGI, useNA = "ifany") #Other

#OTHNORG: Other organization that provided naloxone in the last 6 months
#What is the other organization or entity that provided you with naloxone in the last 6 months?
table(df$OTHNORG, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
tbl.NALUSED <- table(df$NALUSED, useNA = "ifany") 
tbl.NALUSED 
prop.table(tbl.NALUSED)

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
tbl.NALOSE <- table(df$NALOSE, useNA = "ifany") 
tbl.NALOSE 
prop.table(tbl.NALOSE)

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
tbl.NALFILL <- table(df$NALFILL, useNA = "ifany") 
tbl.NALFILL
prop.table(tbl.NALFILL)

#TMEFILL: Days it took to refill or replace naloxone.
#How long after using or losing your Naloxone, did you get a replacement or refill?
tbl.TMEFILL <- table(df$TMEFILL, useNA = "ifany") 
tbl.TMEFILL 
prop.table(tbl.TMEFILL)

#NALPRVD: Who provided the naloxone replacement or refill
#From whom did you receive your naloxone replacement or refill? 
table(df$NALPRVD, useNA = "ifany") 

table(df$NALPRVDA, useNA = "ifany") #Needle exchange
table(df$NALPRVDB, useNA = "ifany") #Another drug user
table(df$NALPRVDC, useNA = "ifany") #Another community member
table(df$NALPRVDD, useNA = "ifany") #A family member
table(df$NALPRVDE, useNA = "ifany") #Pharmacy
table(df$NALPRVDF, useNA = "ifany") #Community clinic
table(df$NALPRVDG, useNA = "ifany") #Hospital
table(df$NALPRVDH, useNA = "ifany") #Jail or prison
table(df$NALPRVDI, useNA = "ifany") #Other

#OTHPRON: Replacement naloxone provided by what other organization
#What is the other organization or entity that provided you with naloxone dose replacement or refill?
table(df$OTHPRON, useNA = "ifany") #Other

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
tbl.NALOWN <- table(df$NALOWN, useNA = "ifany")
tbl.NALOWN
prop.table(tbl.NALOWN)

#NALAVAIL: Naloxone available 
#In the last 6 months, when you injected drugs, how often did you or someone else around you have naloxone in the event of an overdose? 
tbl.NALAVAIL <- table(df$NALAVAIL, useNA = "ifany")
tbl.NALAVAIL 
prop.table(tbl.NALAVAIL)
```


Bar charts using counts for the cascade, whole sample (N=536).
```{r}
#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
tbl.ODTRAIN

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
tbl.NALEVER 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
tbl.NAL6MOS

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
tbl.NALOWN

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
tbl.NALUSED 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
tbl.NALOSE 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
tbl.NALFILL
```


Bar charts using counts for San Francisco (N=312).
```{r}
df_SF <- subset(df, LOCALID == "San Francisco")

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
table(df_SF$ODTRAIN, useNA = "ifany") 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
table(df_SF$NALEVER, useNA = "ifany") 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
table(df_SF$NAL6MOS, useNA = "ifany") 

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
table(df_SF$NALOWN, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
table(df_SF$NALUSED, useNA = "ifany") 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
table(df_SF$NALOSE, useNA = "ifany") 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
table(df_SF$NALFILL, useNA = "ifany") 
```


Bar charts using counts for Los Angeles (N=224).
```{r}
df_LA <- subset(df, LOCALID == "Los Angeles")

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
table(df_LA$ODTRAIN, useNA = "ifany") 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
table(df_LA$NALEVER, useNA = "ifany") 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
table(df_LA$NAL6MOS, useNA = "ifany") 

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
table(df_LA$NALOWN, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
table(df_LA$NALUSED, useNA = "ifany") 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
table(df_LA$NALOSE, useNA = "ifany") 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
table(df_LA$NALFILL, useNA = "ifany")
```


Bar charts using counts for women (N=140).
```{r}
df_women <- subset(df, GENDER == "Female")

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
table(df_women$ODTRAIN, useNA = "ifany") 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
table(df_women$NALEVER, useNA = "ifany") 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
table(df_women$NAL6MOS, useNA = "ifany") 

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
table(df_women$NALOWN, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
table(df_women$NALUSED, useNA = "ifany") 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
table(df_women$NALOSE, useNA = "ifany") 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
table(df_women$NALFILL, useNA = "ifany")
```


Bar charts using counts for men (N=390).
```{r}
df_men <- subset(df, GENDER == "Male")

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
table(df_men$ODTRAIN, useNA = "ifany") 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
table(df_men$NALEVER, useNA = "ifany") 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
table(df_men$NAL6MOS, useNA = "ifany") 

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
table(df_men$NALOWN, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
table(df_men$NALUSED, useNA = "ifany") 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
table(df_men$NALOSE, useNA = "ifany") 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
table(df_men$NALFILL, useNA = "ifany")
```


Bar charts using counts for homeless (N=361).
```{r}
df_homeless <- subset(df, HOMELESS == "Yes")

#ODTRAIN: Have you ever participated in overdose prevention training?
#Have you ever participated in overdose prevention training?
table(df_homeless$ODTRAIN, useNA = "ifany") 

#NALEVER: Ever received naloxone 
#Have you ever received naloxone (including narcan, intranasal narcan, and/or autoinjector 
#of naloxone to use on yourself or other people?
table(df_homeless$NALEVER, useNA = "ifany") 

#NAL6MOS: Received naloxone in the last 6 months 
#Have you received naloxone in the last 6 months?
table(df_homeless$NAL6MOS, useNA = "ifany") 

#NALOWN: Own a dose of naloxone
#Do you currently have at least one dose of naloxone? (By this, we mean you possess 
#or own your own naloxone dose)
table(df_homeless$NALOWN, useNA = "ifany") 

#NALUSED:Used naloxone in the last 6 months
#Have you used your Naloxone in the last 6 months?
table(df_homeless$NALUSED, useNA = "ifany") 

#NALOSE: Lost naloxone in the last 6 months
#Have you lost your Naloxone in the last 6 months?
table(df_homeless$NALOSE, useNA = "ifany") 

#NALFILL: Got a refill of naloxone in the last 6 months
#After using or losing your naloxone, did you get a replacement or refill?
table(df_homeless$NALFILL, useNA = "ifany")
```


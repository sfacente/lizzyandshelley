df.modpoiss <- subset(df, select=c(SUBJECT, NAL6MOS.new, LOCALID, GENDER, agecat, RACE_cat, ED, HOMELESS, JAIL, ANYSTIMUSE, ANYOPIATEUSE, WOD6M, ODP6M))
df.modpoiss <- na.omit(df.modpoiss)
#CITY
localIDbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(LOCALID), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(localIDbynal6mos.modpoiss)
exp(coef(localIDbynal6mos.modpoiss))
#95% CI for city
localIDbynal6mos.modpoiss.RR.coefci.adj <- cbind(localIDbynal6mos.modpoiss$coefficients, confint.default(localIDbynal6mos.modpoiss))
localIDbynal6mos.modpoiss.RR.expci.adj <- exp(localIDbynal6mos.modpoiss.RR.coefci.adj)
localIDbynal6mos.modpoiss.RR.expci.adj
#GENDER
genderbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(GENDER), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(genderbynal6mos.modpoiss)
exp(coef(genderbynal6mos.modpoiss))
#95% CI for gender
genderbynal6mos.modpoiss.RR.coefci.adj <- cbind(genderbynal6mos.modpoiss$coefficients, confint.default(genderbynal6mos.modpoiss))
genderbynal6mos.modpoiss.RR.expci.adj <- exp(genderbynal6mos.modpoiss.RR.coefci.adj)
genderbynal6mos.modpoiss.RR.expci.adj
#agecat
agecatbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(agecat), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(agecatbynal6mos.modpoiss)
exp(coef(agecatbynal6mos.modpoiss))
#95% CI for agecat
agecatbynal6mos.modpoiss.RR.coefci.adj <- cbind(agecatbynal6mos.modpoiss$coefficients, confint.default(agecatbynal6mos.modpoiss))
agecatbynal6mos.modpoiss.RR.expci.adj <- exp(agecatbynal6mos.modpoiss.RR.coefci.adj)
agecatbynal6mos.modpoiss.RR.expci.adj
#race_cat
racecatbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(RACE_cat), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(racecatbynal6mos.modpoiss)
exp(coef(racecatbynal6mos.modpoiss))
#95% CI for racecat
racecatbynal6mos.modpoiss.RR.coefci.adj <- cbind(racecatbynal6mos.modpoiss$coefficients, confint.default(racecatbynal6mos.modpoiss))
racecatbynal6mos.modpoiss.RR.expci.adj <- exp(racecatbynal6mos.modpoiss.RR.coefci.adj)
racecatbynal6mos.modpoiss.RR.expci.adj
#ED
edbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(ED), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(edbynal6mos.modpoiss)
exp(coef(edbynal6mos.modpoiss))
#95% CI for ed
edbynal6mos.modpoiss.RR.coefci.adj <- cbind(edbynal6mos.modpoiss$coefficients, confint.default(edbynal6mos.modpoiss))
edbynal6mos.modpoiss.RR.expci.adj <- exp(edbynal6mos.modpoiss.RR.coefci.adj)
edbynal6mos.modpoiss.RR.expci.adj
#HOMELESS
homelessbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(HOMELESS), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(homelessbynal6mos.modpoiss)
exp(coef(homelessbynal6mos.modpoiss))
#95% CI for homeless
homelessbynal6mos.modpoiss.RR.coefci.adj <- cbind(homelessbynal6mos.modpoiss$coefficients, confint.default(homelessbynal6mos.modpoiss))
homelessbynal6mos.modpoiss.RR.expci.adj <- exp(homelessbynal6mos.modpoiss.RR.coefci.adj)
homelessbynal6mos.modpoiss.RR.expci.adj
#JAIL
jailbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(JAIL), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(jailbynal6mos.modpoiss)
exp(coef(jailbynal6mos.modpoiss))
#95% CI for jail
jailbynal6mos.modpoiss.RR.coefci.adj <- cbind(jailbynal6mos.modpoiss$coefficients, confint.default(jailbynal6mos.modpoiss))
jailbynal6mos.modpoiss.RR.expci.adj <- exp(jailbynal6mos.modpoiss.RR.coefci.adj)
jailbynal6mos.modpoiss.RR.expci.adj
#ANYSTIMUSE
ANYSTIMUSEbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(ANYSTIMUSE), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ANYSTIMUSEbynal6mos.modpoiss)
exp(coef(ANYSTIMUSEbynal6mos.modpoiss))
#95% CI for ANYSTIMUSE
ANYSTIMUSEbynal6mos.modpoiss.RR.coefci.adj <- cbind(ANYSTIMUSEbynal6mos.modpoiss$coefficients, confint.default(ANYSTIMUSEbynal6mos.modpoiss))
ANYSTIMUSEbynal6mos.modpoiss.RR.expci.adj <- exp(ANYSTIMUSEbynal6mos.modpoiss.RR.coefci.adj)
ANYSTIMUSEbynal6mos.modpoiss.RR.expci.adj
#ANYOPIATEUSE
ANYOPIATEUSEbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(ANYOPIATEUSE), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ANYOPIATEUSEbynal6mos.modpoiss)
exp(coef(ANYOPIATEUSEbynal6mos.modpoiss))
#95% CI for ANYOPIATEUSE
ANYOPIATEUSEbynal6mos.modpoiss.RR.coefci.adj <- cbind(ANYOPIATEUSEbynal6mos.modpoiss$coefficients, confint.default(ANYOPIATEUSEbynal6mos.modpoiss))
ANYOPIATEUSEbynal6mos.modpoiss.RR.expci.adj <- exp(ANYOPIATEUSEbynal6mos.modpoiss.RR.coefci.adj)
ANYOPIATEUSEbynal6mos.modpoiss.RR.expci.adj
#WOD6M
WOD6Mbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(WOD6M), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(WOD6Mbynal6mos.modpoiss)
exp(coef(WOD6Mbynal6mos.modpoiss))
#95% CI for WOD6M
WOD6Mbynal6mos.modpoiss.RR.coefci.adj <- cbind(WOD6Mbynal6mos.modpoiss$coefficients, confint.default(WOD6Mbynal6mos.modpoiss))
WOD6Mbynal6mos.modpoiss.RR.expci.adj <- exp(WOD6Mbynal6mos.modpoiss.RR.coefci.adj)
WOD6Mbynal6mos.modpoiss.RR.expci.adj
#ODP6M
ODP6Mbynal6mos.modpoiss <- geeglm(formula=NAL6MOS.new ~ factor(ODP6M), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ODP6Mbynal6mos.modpoiss)
exp(coef(ODP6Mbynal6mos.modpoiss))
#95% CI for ODP6M
ODP6Mbynal6mos.modpoiss.RR.coefci.adj <- cbind(ODP6Mbynal6mos.modpoiss$coefficients, confint.default(ODP6Mbynal6mos.modpoiss))
ODP6Mbynal6mos.modpoiss.RR.expci.adj <- exp(ODP6Mbynal6mos.modpoiss.RR.coefci.adj)
ODP6Mbynal6mos.modpoiss.RR.expci.adj
####DIFFERENT APPROACHES FOR MULTIVARIATE MODELS
####FULL MULTIVARIATE MODIFIED POISSON MODEL WITH EVERY COVARIATE INCLUDED
fitnal6mos.modpoiss  <- geeglm(formula=NAL6MOS.new ~ factor(LOCALID) + factor(GENDER) + factor(agecat) + factor(RACE_cat) + factor(ED) + factor(HOMELESS) + factor(JAIL) + factor(ANYSTIMUSE) + factor(ANYOPIATEUSE) + factor(WOD6M) + factor(ODP6M), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(fitnal6mos.modpoiss)
#extract the coefficients and confidence intervals, exponentiate to get RR and 95% CI (using confint.default)
fitnal6mos.RR.coefci.adj <- cbind(fitnal6mos.modpoiss$coefficients, confint.default(fitnal6mos.modpoiss))
fitnal6mos.RR.expci.adj <- exp(fitnal6mos.RR.coefci.adj)
fitnal6mos.RR.expci.adj
###ADJUSTED MULTIVARIATE MODIFIED POISSON INCLUDING ONLY THOSE SIGNIFICANT AT LESS THAN 0.05 or 0.2 (SO ONLY TAKE OUT GENDER). THE FINDINGS ARE EXACTLY THE SAME
fitnal6mos.modpoiss.approach1  <- geeglm(formula=NAL6MOS.new ~ factor(LOCALID) + factor(agecat) + factor(RACE_cat) + factor(ED) + factor(HOMELESS) + factor(JAIL) + factor(ANYSTIMUSE) + factor(ANYOPIATEUSE) + factor(WOD6M) + factor(ODP6M), data=df.modpoiss, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(fitnal6mos.modpoiss.approach1)
#getting coefficients and standard errors using regular glm and the sandwich estimator
#fitNAL6MOS.new <- glm(NAL6MOS.new ~ factor(LOCALID) + factor(GENDER) + factor(agecat) + factor(ED) + factor(HOMELESS) + factor(JAIL) + factor(ANYSTIMUSE) + factor(ANYOPIATEUSE) + factor(WOD6M) + factor(ODP6M), data=df, family=binomial(log))
#library(sandwich) # to get robust estimators
#library(lmtest) # to test coefficients
#coeftest(fitNAL6MOS.new, vcov = sandwich)
#exp(coef(fitNAL6MOS.new)) #to get RR
## CIs
#localID
#exp(beta + qnorm(0.05 / 2) * SE) # lower 95% CI
#exp(beta  + qnorm(1 - 0.05 / 2) * SE) #upper 95% CI
#subset the data to those who have received naloxone in the last 6 mos
df_nal6mos <- subset(df, NAL6MOS.new == 1) #N = 265 who have received naloxone in the last 6 mos
#checking frequencies are correct
table(df_nal6mos$NALOWN, useNA = "ifany")
#Create a table 1 not stratified by any outcome variable, just for this subset of N = 265 PWID who received naloxone in the last 6mos
table1.subset.receivednal6mos <- CreateTableOne(vars= myVars,
data= df_nal6mos,
factorVars = catVars)
print(table1.subset.receivednal6mos, showAllLevels = TRUE, missing = FALSE)
# Create a table 1 stratified by currently owning naloxone
table1byNALOWN <- CreateTableOne(vars=myVars,
data=df_nal6mos,
factorVars = catVars,
strata="NALOWN")
print(table1byNALOWN, showAllLevels = TRUE, missing = FALSE)
#FOR UNIVARIATES: check column percentages of univariates. this is because prop.table will show missing percentages whereas tableone package doesn't include the missing data when calculating column percents.
#table(df_nal6mos$X, useNA = "ifany")
#round(prop.table(table(df_nal6mos$X, useNA = "ifany")),3)
#FOR BIVARIATES: check column percentages of bivariates. this is because prop.table will show missing percentages whereas tableone package doesn't include the missing data when calculating column percents.
#table(df_nal6mos$X, df_nal6mos$NALOWN, useNA = "ifany")
#round(prop.table(table(df_nal6mos$X, df_nal6mos$NALOWN, useNA = "ifany"),2),3)
#require geepack because modified poisson is picky
require(geepack)
#subset the data with complete observations because geepack is picky (N= 259)
df.modpoiss.nalown <- subset(df_nal6mos, select=c(SUBJECT, NALOWN, LOCALID, GENDER, agecat, RACE_cat, ED, HOMELESS, JAIL, ANYSTIMUSE, ANYOPIATEUSE, WOD6M, ODP6M))
df.modpoiss.nalown <- na.omit(df.modpoiss.nalown)
#recode NALOWN as binary numeric since factor isn't working
df.modpoiss.nalown$NALOWN.binary<-ifelse(df.modpoiss.nalown$NALOWN=='Yes', 1,0)
#LOCALID
localIDbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(LOCALID), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(localIDbynalown.modpoiss)
exp(coef(localIDbynalown.modpoiss))
#95% CI for localID
localIDbynalown.modpoiss.RR.coefci.adj <- cbind(localIDbynalown.modpoiss$coefficients, confint.default(localIDbynalown.modpoiss))
localIDbynalown.modpoiss.RR.expci.adj <- exp(localIDbynalown.modpoiss.RR.coefci.adj)
localIDbynalown.modpoiss.RR.expci.adj
#GENDER
genderbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(GENDER), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(genderbynalown.modpoiss)
exp(coef(genderbynalown.modpoiss))
#95% CI for gender
genderbynalown.modpoiss.RR.coefci.adj <- cbind(genderbynalown.modpoiss$coefficients, confint.default(genderbynalown.modpoiss))
genderbynalown.modpoiss.RR.expci.adj <- exp(genderbynalown.modpoiss.RR.coefci.adj)
genderbynalown.modpoiss.RR.expci.adj
#agecat
agecatbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(agecat), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(agecatbynalown.modpoiss)
exp(coef(agecatbynalown.modpoiss))
#95% CI for agecat
agecatbynalown.modpoiss.RR.coefci.adj <- cbind(agecatbynalown.modpoiss$coefficients, confint.default(agecatbynalown.modpoiss))
agecatbynalown.modpoiss.RR.expci.adj <- exp(agecatbynalown.modpoiss.RR.coefci.adj)
agecatbynalown.modpoiss.RR.expci.adj
#racecat
racecatbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(RACE_cat), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(racecatbynalown.modpoiss)
exp(coef(racecatbynalown.modpoiss))
#95% CI for racecat
racecatbynalown.modpoiss.RR.coefci.adj <- cbind(racecatbynalown.modpoiss$coefficients, confint.default(racecatbynalown.modpoiss))
racecatbynalown.modpoiss.RR.expci.adj <- exp(racecatbynalown.modpoiss.RR.coefci.adj)
racecatbynalown.modpoiss.RR.expci.adj
#ED
edbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(ED), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(edbynalown.modpoiss)
exp(coef(edbynalown.modpoiss))
#95% CI for ed
edbynalown.modpoiss.RR.coefci.adj <- cbind(edbynalown.modpoiss$coefficients, confint.default(edbynalown.modpoiss))
edbynalown.modpoiss.RR.expci.adj <- exp(edbynalown.modpoiss.RR.coefci.adj)
edbynalown.modpoiss.RR.expci.adj
#HOMELESS
homelessbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(HOMELESS), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(homelessbynalown.modpoiss)
exp(coef(homelessbynalown.modpoiss))
#95% CI for homeless
homelessbynalown.modpoiss.RR.coefci.adj <- cbind(homelessbynalown.modpoiss$coefficients, confint.default(homelessbynalown.modpoiss))
homelessbynalown.modpoiss.RR.expci.adj <- exp(homelessbynalown.modpoiss.RR.coefci.adj)
homelessbynalown.modpoiss.RR.expci.adj
#JAIL
jailbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(JAIL), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(jailbynalown.modpoiss)
exp(coef(jailbynalown.modpoiss))
#95% CI for jail
jailbynalown.modpoiss.RR.coefci.adj <- cbind(jailbynalown.modpoiss$coefficients, confint.default(jailbynalown.modpoiss))
jailbynalown.modpoiss.RR.expci.adj <- exp(jailbynalown.modpoiss.RR.coefci.adj)
jailbynalown.modpoiss.RR.expci.adj
#ANYSTIMUSE
ANYSTIMUSEbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(ANYSTIMUSE), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ANYSTIMUSEbynalown.modpoiss)
exp(coef(ANYSTIMUSEbynalown.modpoiss))
#95% CI for ANYSTIMUSE
ANYSTIMUSEbynalown.modpoiss.RR.coefci.adj <- cbind(ANYSTIMUSEbynalown.modpoiss$coefficients, confint.default(ANYSTIMUSEbynalown.modpoiss))
ANYSTIMUSEbynalown.modpoiss.RR.expci.adj <- exp(ANYSTIMUSEbynalown.modpoiss.RR.coefci.adj)
ANYSTIMUSEbynalown.modpoiss.RR.expci.adj
#ANYOPIATEUSE
ANYOPIATEUSEbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(ANYOPIATEUSE), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ANYOPIATEUSEbynalown.modpoiss)
exp(coef(ANYOPIATEUSEbynalown.modpoiss))
#95% CI for ANYOPIATEUSE
ANYOPIATEUSEbynalown.modpoiss.RR.coefci.adj <- cbind(ANYOPIATEUSEbynalown.modpoiss$coefficients, confint.default(ANYOPIATEUSEbynalown.modpoiss))
ANYOPIATEUSEbynalown.modpoiss.RR.expci.adj <- exp(ANYOPIATEUSEbynalown.modpoiss.RR.coefci.adj)
ANYOPIATEUSEbynalown.modpoiss.RR.expci.adj
#WOD6M
WOD6Mbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(WOD6M), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(WOD6Mbynalown.modpoiss)
exp(coef(WOD6Mbynalown.modpoiss))
#95% CI for WOD6M
WOD6Mbynalown.modpoiss.RR.coefci.adj <- cbind(WOD6Mbynalown.modpoiss$coefficients, confint.default(WOD6Mbynalown.modpoiss))
WOD6Mbynalown.modpoiss.RR.expci.adj <- exp(WOD6Mbynalown.modpoiss.RR.coefci.adj)
WOD6Mbynalown.modpoiss.RR.expci.adj
#ODP6M
ODP6Mbynalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(ODP6M), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(ODP6Mbynalown.modpoiss)
exp(coef(ODP6Mbynalown.modpoiss))
#95% CI for ODP6M
ODP6Mbynalown.modpoiss.RR.coefci.adj <- cbind(ODP6Mbynalown.modpoiss$coefficients, confint.default(ODP6Mbynalown.modpoiss))
ODP6Mbynalown.modpoiss.RR.expci.adj <- exp(ODP6Mbynalown.modpoiss.RR.coefci.adj)
ODP6Mbynalown.modpoiss.RR.expci.adj
#MULTIVARIATE MODELS USING DIFFERENT APPROACHES
#full multivariate model using every covariate regardless of significance
fitnalown.modpoiss <- geeglm(formula=NALOWN.binary ~ factor(LOCALID) + factor(GENDER) + factor(agecat) + factor(RACE_cat) + factor(ED) + factor(HOMELESS) + factor(JAIL) + factor(ANYSTIMUSE) + factor(ANYOPIATEUSE) + factor(WOD6M) + factor(ODP6M), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(fitnalown.modpoiss)
exp(coef(fitnalown.modpoiss))
#extract the coefficients and confidence intervals, exponentiate to get RR and 95% CI (using confint.default)
fitnalown.RR.coefci.adj <- cbind(fitnalown.modpoiss$coefficients, confint.default(fitnalown.modpoiss))
fitnalown.RR.expci.adj <- exp(fitnalown.RR.coefci.adj)
fitnalown.RR.expci.adj
###ADJUSTED MULTIVARIATE MODIFIED POISSON INCLUDING ONLY THOSE SIGNIFICANT AT LESS THAN 0.2 (not using p < .05 because then the model is only housing and jail)
fitnalown.modpoiss.approach1 <- geeglm(formula=NALOWN.binary ~ factor(LOCALID) + factor(agecat) + factor(ED) + factor(HOMELESS) + factor(JAIL)  + factor(ANYOPIATEUSE), data=df.modpoiss.nalown, id=SUBJECT, family=poisson(link="log"), corstr = "exchangeable")
summary(fitnalown.modpoiss.approach1)
localIDbynal6mos.modpoiss.RR.expci.adj <- exp(localIDbynal6mos.modpoiss.RR.coefci.adj)
localIDbynal6mos.modpoiss.RR.expci.adj
genderbynal6mos.modpoiss.RR.expci.adj
round(localIDbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(genderbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(agecatbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(racecatbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(edbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(homelessbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(jailbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ANYSTIMUSEbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ANYOPIATEUSEbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(WOD6Mbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ODP6Mbynal6mos.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(localIDbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(genderbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(agecatbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(racecatbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(edbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(homelessbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(jailbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ANYSTIMUSEbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ANYOPIATEUSEbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(WOD6Mbynalown.modpoiss.RR.expci.adj, 2)
#rounded to two decimal places
round(ODP6Mbynalown.modpoiss.RR.expci.adj, 2)
knitr::opts_chunk$set(echo = T, eval=T, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=85),tidy=TRUE)
library(base)
library(knitr)
library(dplyr)
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(tableone)
library(forcats)
library(geepack)
library(doBy)
library(blm)
library(lmtest)
library(foreign)
library(MASS)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("CTC12month.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
df <- df[rowSums(is.na(df)) < 600,] #rows reduced from N=984 to N=536 people
#EXAMPLES OF SUBSETTING
#df <- subset(df, SUMINJ>0)
#df <- subset(df, IJWOTH_3cat>0)
View(df.labels)
knitr::opts_chunk$set(echo = TRUE)
###SPEEDBALL###
table(df$SB30, useNA = "ifany") #used speedball yes/no (heroin + cocaine or crack)
###CRACK###
#used crack yes/no
table(df$CRKNINJ, useNA = "ifany") #non-injection crack (# times)
table(df$CRKINJ, useNA = "ifany") #injection crack (# times)
table(df$SB30, useNA = "ifany") #used speedball yes/no (heroin + cocaine or crack)
table(df$SBNINJ, useNA = "ifany")  #any non-injection speedball
table(df$SBX, useNA = "ifany")  #non-injection speedball (# of times)
table(df$SBINJ, useNA = "ifany")  #any injection speedball
table(df$SBIX, useNA = "ifany")  #injection speedball (# of times)
#any stimulant use in last 30 days (injection and/or non-injection composite)
df$ANYSTIMUSE <- ifelse(df$CRKNINJ=="Yes" | df$CCNINJ=="Yes" | df$MTNINJ=="Yes" | df$STNINJ=="Yes" |df$SBNINJ =="Yes" |df$GBNINJ=="Yes" | df$CRKINJ=="Yes" | df$CCINJ=="Yes" | df$MTINJ=="Yes" | df$STINJ=="Yes" |df$SBINJ="Yes"| df$GBINJ=="Yes", 1, ifelse(df$CRKNINJ=="No" &df$CCNINJ=="No" & df$MTNINJ=="No" & df$STNINJ=="No" & df$SBNINJ=="No" & df$GBNINJ=="No" & df$CRKINJ=="No" &  df$CCINJ=="No" & df$MTINJ=="No" & df$STINJ=="No" & df$SBINJ=="No" & df$GBINJ=="No", 0, NA))
#any stimulant use in last 30 days (injection and/or non-injection composite)
df$ANYSTIMUSE <- ifelse(df$CRKNINJ=="Yes" | df$CCNINJ=="Yes" | df$MTNINJ=="Yes" | df$STNINJ=="Yes" |df$SBNINJ =="Yes" |df$GBNINJ=="Yes" | df$CRKINJ=="Yes" | df$CCINJ=="Yes" | df$MTINJ=="Yes" | df$STINJ=="Yes" |df$SBINJ=="Yes"| df$GBINJ=="Yes", 1, ifelse(df$CRKNINJ=="No" &df$CCNINJ=="No" & df$MTNINJ=="No" & df$STNINJ=="No" & df$SBNINJ=="No" & df$GBNINJ=="No" & df$CRKINJ=="No" &  df$CCINJ=="No" & df$MTINJ=="No" & df$STINJ=="No" & df$SBINJ=="No" & df$GBINJ=="No", 0, NA))
df$ANYSTIMUSE <- as.factor(df$ANYSTIMUSE)
table(df$ANYSTIMUSE, useNA = "ifany")
df$ANYOPIATEUSE <- ifelse(df$SBINJ=="Yes" | df$GBINJ=="Yes" | df$MDINJ=="Yes" | df$BUPINJ=="Yes" | df$HRINJ=="Yes" | df$OPINJ=="Yes" |df$SBNINJ=="Yes" | df$GBNINJ=="Yes" |  df$MDNINJ=="Yes" |  df$BUPNINJ=="Yes" |  df$HRNINJ=="Yes" | df$OPNINJ=="Yes", 1, ifelse(df$SBINJ=="No" & df$GBINJ=="No"  & df$MDINJ=="No"  & df$BUPINJ=="No" & df$HRINJ=="No" & df$OPINJ=="No"  & df$SBNINJ=="No" & df$GBNINJ=="No"  & df$MDNINJ=="No"  & df$BUPNINJ=="No" & df$HRNINJ=="No" & df$OPNINJ=="No", 0, NA))
df$ANYOPIATEUSE <- as.factor(df$ANYOPIATEUSE)
table(df$ANYOPIATEUSE, useNA = "ifany")
table(df$ANYSTIMUSE, useNA = "ifany")
table(df$ANYOPIATEUSE, useNA = "ifany")
table(df$HER30, useNA = "ifany") #used heroin yes/no
table(df$HRNINJ, useNA = "ifany") #any non-injection heroin
table(df$HERX, useNA = "ifany") #non-injection heroin (# times)
table(df$HRINJ, useNA = "ifany") #any injection heroin
table(df$HERIX, useNA = "ifany") #injection heroin (# times)
182+354
434+102
class(df$SBX)
table(df$SBX)
class(df$SBIX)
class(df$SBX)
df$SBX <- as.integer(df$SBX)
class(df$SBX)
df$SB_HIGHFREQ <- ifelse(df$SBX>90 | df$SBIX>90, 1, 0, NA)
df$SB_HIGHFREQ <- ifelse(df$SBX>90 | df$SBIX>90, 1, 0)
df$SBX <- as.integer(df$SBX) #change to numeric instead of factor
df$SBIX <- as.integer(df$SBX) #change to numeric instead of factor
df$SB_HIGHFREQ <- ifelse(df$SBX>90 | df$SBIX>90, 1, 0)
table(df$SB_HIGHFREQ)
table(df$SBX, useNA = "ifany")
table(df$SB_HIGHFREQ, useNA = "ifany")
130+406
table(df$SBX, useNA = "ifany")
table(df$SBIX, useNA = "ifany")
df$GBX <- as.integer(df$SBX) #change to numeric instead of factor
df$GBIX <- as.integer(df$SBX) #change to numeric instead of factor
table(df$GBX, useNA = "ifany")
table(df$GBIX, useNA = "ifany")
table(df$SB_HIGHFREQ, useNA = "ifany")
df$GBX <- as.integer(df$GBX) #change to numeric instead of factor
df$GBIX <- as.integer(df$GBIX) #change to numeric instead of factor
df$GB_HIGHFREQ <- ifelse(df$GBX>90 | df$GBIX>90, 1, 0)
table(df$SB_HIGHFREQ, useNA = "ifany")
df$CRCKX <- as.integer(df$CRCKX) #change to numeric instead of factor
df$CRCKIX <- as.integer(df$CRCKIX) #change to numeric instead of factor
table(df$CRCKX, useNA = "ifany")
table(df$CRCKIX, useNA = "ifany")
table(df$SBX, useNA = "ifany")  #non-injection speedball (# of times)
table(df$SBIX, useNA = "ifany")  #injection speedball (# of times)
table(df$GBX, useNA = "ifany")   #non-injection goofball (# times)
table(df$GBIX, useNA = "ifany")   #injection goofball (# times)
table(df$CRCKX, useNA = "ifany")   #non-injection crack (# times)
table(df$CRCKIX, useNA = "ifany") #injection crack (# times)
table(df$PCOKEX, useNA = "ifany") #non-injection powder cocaine (times)
table(df$PCOKEIX, useNA = "ifany") #injection powder cocaine (# times)
table(df$STX, useNA = "ifany") #non-injection NMPS (# times)
table(df$STIX, useNA = "ifany") #injection NMPS (# times)
table(df$HERX, useNA = "ifany") #non-injection heroin (# times)
table(df$HERIX, useNA = "ifany") #injection heroin (# times)
table(df$OPX, useNA = "ifany") #non-injection NMPO (# times)
table(df$OPIX, useNA = "ifany") #injection NMPO (# times)
table(df$MDX, useNA = "ifany") #non-injection methadone (# times)
table(df$MDIX, useNA = "ifany") #injection methadone (# times)
table(df$BUPX, useNA = "ifany") #non-injection bup (# times)
table(df$BUPIX, useNA = "ifany") #injection bup (# times)
table(df$SBX, useNA = "ifany")  #non-injection speedball (# of times)
table(df$SBIX, useNA = "ifany")  #injection speedball (# of times)
table(df$GBX, useNA = "ifany")   #non-injection goofball (# times)
table(df$GBIX, useNA = "ifany")   #injection goofball (# times)
table(df$CRCKX, useNA = "ifany")   #non-injection crack (# times)
table(df$CRCKIX, useNA = "ifany") #injection crack (# times)
table(df$PCOKEX, useNA = "ifany") #non-injection powder cocaine (times)
table(df$PCOKEIX, useNA = "ifany") #injection powder cocaine (# times)
table(df$METHX, useNA = "ifany") #non-injection meth (# times)
table(df$METHIX, useNA = "ifany") #injection meth (# times)
table(df$STX, useNA = "ifany") #non-injection NMPS (# times)
table(df$STIX, useNA = "ifany") #injection NMPS (# times)
table(df$HERX, useNA = "ifany") #non-injection heroin (# times)
table(df$HERIX, useNA = "ifany") #injection heroin (# times)
table(df$MDX, useNA = "ifany") #non-injection methadone (# times)
table(df$MDIX, useNA = "ifany") #injection methadone (# times)
table(df$BUPX, useNA = "ifany") #non-injection bup (# times)
table(df$BUPIX, useNA = "ifany") #injection bup (# times)
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$SBX <- as.integer(df$SBX) #change to numeric instead of factor
df$SBIX <- as.integer(df$SBX) #change to numeric instead of factor
df$SBX <- as.integer(df$SBX) #change to numeric instead of factor
df$SBIX <- as.integer(df$SBIX) #change to numeric instead of factor
df$SB_dailymore <- ifelse(df$SBX>=30 | df$SBIX>=30, 1, 0)
table(df$SB_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$GBX <- as.integer(df$GBX) #change to numeric instead of factor
df$GBIX <- as.integer(df$GBIX) #change to numeric instead of factor
df$GB_dailymore <- ifelse(df$GBX>=30 | df$GBIX>=30, 1, 0)
table(df$GB_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$CRCKX <- as.integer(df$CRCKX) #change to numeric instead of factor
df$CRCKIX <- as.integer(df$CRCKIX) #change to numeric instead of factor
df$CRCK_dailymore <- ifelse(df$CRCKX>=30 | df$CRCKIX>=30, 1, 0)
table(df$CRCK_dailymore, useNA = "ifany")
df$PCOKEX <- as.integer(df$PCOKEX) #change to numeric instead of factor
df$PCOKEIX <- as.integer(df$PCOKEIX) #change to numeric instead of factor
df$PCOKE_dailymore <- ifelse(df$PCOKEX>=30 | df$PCOKEIX>=30, 1, 0)
table(df$PCOKE_dailymore, useNA = "ifany")
df$METHX <- as.integer(df$METHX) #change to numeric instead of factor
df$METHIX <- as.integer(df$METHIX) #change to numeric instead of factor
df$METH_dailymore <- ifelse(df$METHX>=30 | df$METHIX>=30, 1, 0)
table(df$METH_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$STX <- as.integer(df$STX) #change to numeric instead of factor
df$STIX <- as.integer(df$STIX) #change to numeric instead of factor
df$ST_dailymore <- ifelse(df$STX>=30 | df$STIX>=30, 1, 0)
table(df$ST_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$HERX <- as.integer(df$HERX) #change to numeric instead of factor
df$HERIX <- as.integer(df$HERIX) #change to numeric instead of factor
df$HER_dailymore <- ifelse(df$HERX>=30 | df$HERIX>=30, 1, 0)
table(df$HER_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$OPX <- as.integer(df$OPX) #change to numeric instead of factor
df$OPIX <- as.integer(df$OPIX) #change to numeric instead of factor
df$OP_dailymore <- ifelse(df$OPX>=30 | df$OPIX>=30, 1, 0)
table(df$OP_dailymore, useNA = "ifany")
df$MDX <- as.integer(df$MDX) #change to numeric instead of factor
df$MDIX <- as.integer(df$MDIX) #change to numeric instead of factor
df$MD_dailymore <- ifelse(df$MDX>=30 | df$MDIX>=30, 1, 0)
table(df$MD_dailymore, useNA = "ifany")
#if we want to create a variable for at least daily speedball use (>=30 times past 30 days)
df$BUPX <- as.integer(df$BUPX) #change to numeric instead of factor
df$BUPIX <- as.integer(df$BUPIX) #change to numeric instead of factor
df$BUP_dailymore <- ifelse(df$BUPX>=30 | df$BUPIX>=30, 1, 0)
table(df$BUP_dailymore, useNA = "ifany")
table(df$SB_dailymore, useNA = "ifany")
table(df$GB_dailymore, useNA = "ifany")
table(df$CRCK_dailymore, useNA = "ifany")
table(df$PCOKE_dailymore, useNA = "ifany")
table(df$METH_dailymore, useNA = "ifany")
table(df$ST_dailymore, useNA = "ifany")
table(df$HER_dailymore, useNA = "ifany")
table(df$OP_dailymore, useNA = "ifany")
table(df$OP_dailymore, useNA = "ifany")
table(df$OPX, useNA = "ifany") #non-injection NMPO (# times)
table(df$OPIX, useNA = "ifany") #injection NMPO (# times)
table(df$HER_dailymore, useNA = "ifany")
df$OP_dailymore <- ifelse(df$OPX>=30 | df$OPIX>=30, 1, 0)
table(df$OP_dailymore, useNA = "ifany")
table(df$MD_dailymore, useNA = "ifany")
table(df$BUP_dailymore, useNA = "ifany")
table(df$CRCK_dailymore, useNA = "ifany")
table(df$PCOKE_dailymore, useNA = "ifany")
table(df$METH_dailymore, useNA = "ifany")
table(df$ST_dailymore, useNA = "ifany")
table(df$HER_dailymore, useNA = "ifany")
table(df$OP_dailymore, useNA = "ifany")
STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1, | df$ST_dailymore=1, 1, 0)
STIM_dailymore <- ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$CRCK_dailymore==1 | df$PCOKE_dailymore==1 | df$METH_dailymore==1, | df$ST_dailymore==1, 1, 0)
STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1 | df$ST_dailymore=1, 1, 0)
STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1 | df$ST_dailymore=1, 1, 0)
df$STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1 | df$ST_dailymore=1, 1, 0)
df$STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1 | df$ST_dailymore=1, 1, 0)
df$STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore | df$ST_dailymore=1, 1, 0)
df$STIM_dailymore <- ifelse(df$SB_dailymore=1 | df$GB_dailymore=1 | df$CRCK_dailymore=1 | df$PCOKE_dailymore=1 | df$METH_dailymore=1 | df$ST_dailymore=1, 1, 0)
#error saying I have an unexpected "=" in this ifelse statement?
df$STIM_dailymore <- ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$CRCK_dailymore==1 | df$PCOKE_dailymore==1 | df$METH_dailymore==1 | df$ST_dailymore==1, 1, 0)
table(df$STIM_dailymore, useNA = "ifany")
OPIOID_dailymore < - ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$HER_dailymore==1 | df$OP_dailymore==1 | df$MD_dailymore==1 | df$BUP_dailymore==1, 1, 0)
df$OPIOID_dailymore < - ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$HER_dailymore==1 | df$OP_dailymore==1 | df$MD_dailymore==1 | df$BUP_dailymore==1, 1, 0)
table(df$OPIOID_dailymore, useNA = "ifany")
df$OPIOID_dailymore < - ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$HER_dailymore==1 | df$OP_dailymore==1 | df$MD_dailymore==1 | df$BUP_dailymore==1, 1, 0)
#ANY DAILY OR MORE STIMULANT USE (>=30 times in past 30 days)
df$STIM_dailymore <- ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$CRCK_dailymore==1 | df$PCOKE_dailymore==1 | df$METH_dailymore==1 | df$ST_dailymore==1, 1, 0)
table(df$STIM_dailymore, useNA = "ifany")
df$OPIOID_dailymore < - ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$HER_dailymore==1 | df$OP_dailymore==1 | df$MD_dailymore==1 | df$BUP_dailymore==1, 1, 0)
df$OPIOID_dailymore <- ifelse(df$SB_dailymore==1 | df$GB_dailymore==1 | df$HER_dailymore==1 | df$OP_dailymore==1 | df$MD_dailymore==1 | df$BUP_dailymore==1, 1, 0)
table(df$OPIOID_dailymore, useNA = "ifany")
table(df$STIM_dailymore, useNA = "ifany")
table(df$OPIOID_dailymore, useNA = "ifany")

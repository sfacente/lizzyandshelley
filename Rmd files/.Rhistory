df$ANYOPIATE <- ifelse(df$HRINJ=="Yes" | df$OPINJ=="Yes", 1, ifelse(df$HRINJ=="No" & df$OPINJ=="No", 0, NA))
table(df$ANYOPIATE, useNA = "ifany")
modelpoisson <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", data = df, na.action = na.omit)
summary(modelpoisson)
modelpoisson_offset <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", offset = log(df$SUMINJ), data = df, na.action = na.omit)
summary(modelpoisson_offset)
model.nb <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, data = df, na.action = na.omit)
summary(model.nb)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
lrtest(modelpoisson, model.nb)
AIC(modelpoisson, model.nb)
lrtest(modelpoisson_offset, model.nb.offset)
AIC(modelpoisson_offset, model.nb.offset)
lrtest(model.nb, model.nb.offset)
AIC(model.nb, model.nb.offset)
test <- model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(df$SUMINJ), data = df, na.action = na.omit)
exp( -0.495997)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + binge_ offset(log(df$SUMINJ)), data = df, na.action = na.omit)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + binge + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
test
summary(test)
test <- glm.nb(RECSHR ~ PUBINJ_3cat + HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(test)
exp(-0.465133)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
table(df$SUMINJ)
mean(df$RECSHR)
class(df$RECSHR)
mean((df$RECSHR))
table(df$RECSHR)
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#setwd("~/GitHub/lizzyandshelley/Dataset")  #SHELLEY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#subsetting the data to only include people who injected in past 30 days (only removes 5 ppl)
df <- subset(df, SUMINJ>0)
#public injection
table(df$PUBINJ, useNA = "ifany") #Frequency of public injection (ordinal)
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$PUBINJ_3cat <- as.factor(ifelse(df$PUBINJ=="Never (0% of the time)", 0, ifelse(df$PUBINJ=="Occasionally (less than 25% of the time)" | df$PUBINJ=="Sometimes (25% to 74% of the time)", 1, ifelse(df$PUBINJ=="Usually (75% to 99% of the time)" | df$PUBINJ=="Always (100% of the time)", 2, NA))))
table(df$PUBINJ_3cat, useNA = "ifany")
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
df$RECSHR <- as.numeric(df$RECSHR)
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#setwd("~/GitHub/lizzyandshelley/Dataset")  #SHELLEY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#subsetting the data to only include people who injected in past 30 days (only removes 5 ppl)
df <- subset(df, SUMINJ>0)
#public injection
table(df$PUBINJ, useNA = "ifany") #Frequency of public injection (ordinal)
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$PUBINJ_3cat <- as.factor(ifelse(df$PUBINJ=="Never (0% of the time)", 0, ifelse(df$PUBINJ=="Occasionally (less than 25% of the time)" | df$PUBINJ=="Sometimes (25% to 74% of the time)", 1, ifelse(df$PUBINJ=="Usually (75% to 99% of the time)" | df$PUBINJ=="Always (100% of the time)", 2, NA))))
table(df$PUBINJ_3cat, useNA = "ifany")
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
class(df$RECSHR)
df$RECSHR <- as.numeric(as.character(df$RECSHR))
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#setwd("~/GitHub/lizzyandshelley/Dataset")  #SHELLEY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#subsetting the data to only include people who injected in past 30 days (only removes 5 ppl)
df <- subset(df, SUMINJ>0)
#public injection
table(df$PUBINJ, useNA = "ifany") #Frequency of public injection (ordinal)
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$PUBINJ_3cat <- as.factor(ifelse(df$PUBINJ=="Never (0% of the time)", 0, ifelse(df$PUBINJ=="Occasionally (less than 25% of the time)" | df$PUBINJ=="Sometimes (25% to 74% of the time)", 1, ifelse(df$PUBINJ=="Usually (75% to 99% of the time)" | df$PUBINJ=="Always (100% of the time)", 2, NA))))
table(df$PUBINJ_3cat, useNA = "ifany")
class(df$PUBINJ_3cat)
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
df$RECSHR <- as.numeric(as.character(df$RECSHR))
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
table(df$AGE, useNA = "ifany")
#age at baseline (years)
df$AGE <- as.numeric(as.character(df$AGE))
table(df$AGE, useNA = "ifany")
#gender
table(df$GENDER, useNA = "ifany")
#homelessness
table(df$HOMELESS)
class(df$HOMELESS)
table(df$MOSHOME)
df$MOSHOME <- as.numeric(as.character(df$MOSHOME)) #number of months homeless
table(df$MOSHOME)
df$YRSHOME <- df$MOSHOME/12
class(df$YRSHOME)
table(df$HOMELESS, useNA = "ifany")
table(df$MOSHOME, useNA = "ifany")
table(df$YRSHOME, useNA = "ifany")
N
table(df$SUMINJ, useNA = "ifany")
#total number of injections last 30 days (offset term? should I keep this as 30 or multiply by 6?)
df$SUMINJ <- as.numeric(as.character(df$SUMINJ))
table(df$SUMINJ, useNA = "ifany")
#frequency of injecting with others in last 6 months
table(df$IJWOTH, useNA = "ifany")
#crack injection
table(df$CRKINJ, useNA = "ifany")
#powder cocaine injection
table(df$CCINJ, useNA = "ifany")
#meth injection
table(df$MTINJ, useNA = "ifany")
#prescription stimulant injection
table(df$STINJ, useNA = "ifany")
#heroin injection
table(df$HRINJ, useNA = "ifany")
#NMPO injection
table(df$OPINJ, useNA = "ifany")
table(df$ALCDAY, useNA = "ifany")
#alcohol
df$ALCDAY <- as.numeric(as.character(df$ALCDAY)) #Days of alcohol use in last 30 days
table(df$ALCDAY, useNA = "ifany")
table(df$ALCTX, useNA = "ifany")
df$ALCTX <- as.numeric(as.character(df$ALCTX)) #Times you drank on a typical day
table(df$ALCTX, useNA = "ifany")
df$binge <- ifelse(df$ALCDAY==0, 0, ifelse(df$ALCTX<4, 0, ifelse(df$ALCTX>3, 1, NA))) #binge alcohol on a typical day (>3 drinks)
table(df$binge, useNA = "ifany")
#any stimulant injection (composite)
df$ANYSTIM <- ifelse(df$CRKINJ=="Yes" | df$CCINJ=="Yes" | df$MTINJ=="Yes" | df$STINJ=="Yes", 1, ifelse(df$CRKINJ=="No" & df$CCINJ=="No" & df$MTINJ=="No" & df$STINJ=="No", 0, NA))
table(df$ANYSTIM, useNA = "ifany")
#any opioid injection (composite)
df$ANYOPIATE <- ifelse(df$HRINJ=="Yes" | df$OPINJ=="Yes", 1, ifelse(df$HRINJ=="No" & df$OPINJ=="No", 0, NA))
table(df$ANYOPIATE, useNA = "ifany")
modelpoisson <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", data = df, na.action = na.omit)
summary(modelpoisson)
modelpoisson_offset <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", offset = log(df$SUMINJ), data = df, na.action = na.omit)
summary(modelpoisson_offset)
model.nb <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, data = df, na.action = na.omit)
summary(model.nb)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
lrtest(modelpoisson, model.nb)
AIC(modelpoisson, model.nb)
lrtest(modelpoisson_offset, model.nb.offset)
AIC(modelpoisson_offset, model.nb.offset)
#comparing negative binomials with and without offset
lrtest(model.nb, model.nb.offset)
AIC(model.nb, model.nb.offset)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + IJWOTH + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 100)
summary(model.nb.offset)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(model.nb.offset)
test <- glm.nb(RECSHR ~ PUBINJ_3cat + HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(test)
summary(model.nb.offset)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(test)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(test)
test <-  glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + IJWOTH + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(test)
table(df$IJWOTH)
class(df$IJWOTH)
levels(df$IJWOTH)
df_ijwoth <- subset(df, IJWOTH>0)
df_ijwoth <- subset(df, IJWOTH!=0)
levels(df_ijwoth$IJWOTH)
df_ijwoth <- subset(df, IJWOTH!="Never (0% of the time)")
levels(df_ijwoth$IJWOTH)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(model.nb.offset)
#frequency of injecting with others in last 6 months
table(df$IJWOTH, useNA = "ifany")
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$IJWOTH_3cat <- as.factor(ifelse(df$IJWOTH=="Never (0% of the time)", 0, ifelse(df$IJWOTH=="Occasionally (less than 25% of the time)" | df$IJWOTH=="Sometimes (25% to 74% of the time)", 1, ifelse(df$IJWOTH=="Usually (75% to 99% of the time)" | df$IJWOTH=="Always (100% of the time)", 2, NA))))
table(df$IJWOTH_3cat, useNA = "ifany")
#playing around
dfnew <- subset(df, IJWOTH_3cat>0)
class(df$SUMINJ)
#playing around
df$IJWOTH_3cat <- as.numeric(as.character(df$IJWOTH_3cat))
table(df$IJWOTH_3cat, useNA = "ifany")
dfnew <- subset(df, IJWOTH_3cat>0)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(test)
table(df$PUBINJ_3cat, df$HOMELESS)
table(df$HOMELESS, df$PUBINJ_3cat)
table(df$HOMELESS, df$IJWOTH_3cat)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = dfnew, na.action = na.omit, maxit = 500)
dfnew <- subset(dfnew, SUMINJ>0)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = dfnew, na.action = na.omit, maxit = 500)
summary(test)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(dfnew$SUMINJ)), data = dfnew, na.action = na.omit, maxit = 500)
summary(test)
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#subsetting the data to only include people who injected in past 30 days (only removes 5 ppl)
df <- subset(df, SUMINJ>0)
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#subsetting the data to only include people who injected in past 30 days (only removes 5 ppl)
df <- subset(df, SUMINJ>0)
df.labels$description[df.labels$VAR_ID=="IJWOTH"]
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
df.labels$description[df.labels$VAR_ID=="SUMINJ"]
df.labels$description[df.labels$VAR_ID=="IJWOTH"]
table(df$SUMINJ, useNA = "ifany")
#total number of injections last 30 days
df$SUMINJ <- as.numeric(as.character(df$SUMINJ))
table(df$SUMINJ, useNA = "ifany")
#frequency of injecting with others in last 6 months
table(df$IJWOTH, useNA = "ifany")
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$IJWOTH_3cat <- as.factor(ifelse(df$IJWOTH=="Never (0% of the time)", 0, ifelse(df$IJWOTH=="Occasionally (less than 25% of the time)" | df$IJWOTH=="Sometimes (25% to 74% of the time)", 1, ifelse(df$IJWOTH=="Usually (75% to 99% of the time)" | df$IJWOTH=="Always (100% of the time)", 2, NA))))
table(df$IJWOTH_3cat, useNA = "ifany")
#Subsetting the analytic sample to people with greater than 0 injections and greater than never injecting with others.
df <- subset(df, SUMINJ>0)
df < subset(df, IJWOTH_3cat>0)
#Subsetting the analytic sample to people with greater than 0 injections and greater than never injecting with others.
df <- subset(df, SUMINJ>0)
df <- subset(df, IJWOTH_3cat>0)
table(df$IJWOTH_3cat, useNA = "ifany")
knitr::opts_chunk$set(echo = F, eval=F, warning = FALSE, message = FALSE, global.par=TRUE)
knitr::opts_knit$set(root.dir="~/Documents/GitHub/lizzyandshelley/Dataset")
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
library(mice)
library(biostat3)
library(lmtest)
library(gee)
#set working directory
setwd("~/Documents/GitHub/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
table(df$SUMINJ, useNA = "ifany")
#total number of injections last 30 days
df$SUMINJ <- as.numeric(as.character(df$SUMINJ))
table(df$SUMINJ, useNA = "ifany")
#frequency of injecting with others in last 6 months
table(df$IJWOTH, useNA = "ifany")
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$IJWOTH_3cat <- as.factor(ifelse(df$IJWOTH=="Never (0% of the time)", 0, ifelse(df$IJWOTH=="Occasionally (less than 25% of the time)" | df$IJWOTH=="Sometimes (25% to 74% of the time)", 1, ifelse(df$IJWOTH=="Usually (75% to 99% of the time)" | df$IJWOTH=="Always (100% of the time)", 2, NA))))
class(df$IJWOTH_3cat)
table(df$IJWOTH_3cat, useNA = "ifany")
df$IJWOTH_3cat <- as.numeric(as.character(df$IJWOTH_3cat))
table(df$IJWOTH_3cat, useNA = "ifany")
#Subsetting the analytic sample to people with greater than 0 injections and greater than never injecting with others.
df <- subset(df, SUMINJ>0) #sample from 984 to
df <- subset(df, IJWOTH_3cat>0) #sample from 979 to
#public injection
table(df$PUBINJ, useNA = "ifany") #Frequency of public injection (ordinal)
#convert to 3 level variable (0 = never, 1 = occasionally/sometimes, 2 = usually/always)
df$PUBINJ_3cat <- as.factor(ifelse(df$PUBINJ=="Never (0% of the time)", 0, ifelse(df$PUBINJ=="Occasionally (less than 25% of the time)" | df$PUBINJ=="Sometimes (25% to 74% of the time)", 1, ifelse(df$PUBINJ=="Usually (75% to 99% of the time)" | df$PUBINJ=="Always (100% of the time)", 2, NA))))
table(df$PUBINJ_3cat, useNA = "ifany")
class(df$PUBINJ_3cat)
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
df$RECSHR <- as.numeric(as.character(df$RECSHR))
table(df$RECSHR, useNA = "ifany") #Times used dirty needles last 6 months
#age at baseline (years)
df$AGE <- as.numeric(as.character(df$AGE))
table(df$AGE, useNA = "ifany")
#gender
table(df$GENDER, useNA = "ifany")
#homelessness
table(df$HOMELESS) #do you consider yourself homeless
df$MOSHOME <- as.numeric(as.character(df$MOSHOME)) #number of months homeless
df$YRSHOME <- df$MOSHOME/12
table(df$HOMELESS, useNA = "ifany")
table(df$MOSHOME, useNA = "ifany")
table(df$YRSHOME, useNA = "ifany")
#crack injection
table(df$CRKINJ, useNA = "ifany")
#powder cocaine injection
table(df$CCINJ, useNA = "ifany")
#meth injection
table(df$MTINJ, useNA = "ifany")
#prescription stimulant injection
table(df$STINJ, useNA = "ifany")
#heroin injection
table(df$HRINJ, useNA = "ifany")
#NMPO injection
table(df$OPINJ, useNA = "ifany")
#alcohol
df$ALCDAY <- as.numeric(as.character(df$ALCDAY)) #Days of alcohol use in last 30 days
df$ALCTX <- as.numeric(as.character(df$ALCTX)) #Times you drank on a typical day
df$binge <- ifelse(df$ALCDAY==0, 0, ifelse(df$ALCTX<4, 0, ifelse(df$ALCTX>3, 1, NA))) #binge alcohol on a typical day (>3 drinks)
table(df$ALCDAY, useNA = "ifany")
table(df$ALCTX, useNA = "ifany")
table(df$binge, useNA = "ifany")
#any stimulant injection (composite)
df$ANYSTIM <- ifelse(df$CRKINJ=="Yes" | df$CCINJ=="Yes" | df$MTINJ=="Yes" | df$STINJ=="Yes", 1, ifelse(df$CRKINJ=="No" & df$CCINJ=="No" & df$MTINJ=="No" & df$STINJ=="No", 0, NA))
table(df$ANYSTIM, useNA = "ifany")
#any opioid injection (composite)
df$ANYOPIATE <- ifelse(df$HRINJ=="Yes" | df$OPINJ=="Yes", 1, ifelse(df$HRINJ=="No" & df$OPINJ=="No", 0, NA))
table(df$ANYOPIATE, useNA = "ifany")
modelpoisson <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", data = df, na.action = na.omit)
summary(modelpoisson)
modelpoisson_offset <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", offset = log(df$SUMINJ), data = df, na.action = na.omit)
summary(modelpoisson_offset)
model.nb <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, data = df, na.action = na.omit)
summary(model.nb)
modelpoisson <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", data = df, na.action = na.omit)
summary(modelpoisson)
modelpoisson_offset <- glm(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, family = "poisson", offset = log(df$SUMINJ), data = df, na.action = na.omit)
summary(modelpoisson_offset)
model.nb <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE, data = df, na.action = na.omit)
summary(model.nb)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit, maxit = 500)
summary(model.nb.offset)
#comparing poisson and negative binomial without offsets
lrtest(modelpoisson, model.nb)
AIC(modelpoisson, model.nb)
#comparing poisson and negative binomial with offsets
lrtest(modelpoisson_offset, model.nb.offset)
AIC(modelpoisson_offset, model.nb.offset)
#comparing negative binomials with and without offset
lrtest(model.nb, model.nb.offset)
AIC(model.nb, model.nb.offset)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
test <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(test)
summary(model.nb.offset)
exp(2.02466)
test <- glm.nb(RECSHR ~ PUBINJ*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(test)
glm.nb(RECSHR ~ HOMELESS)
glm.nb(RECSHR ~ HOMELESS + offset(log(df$SUMINJ)), data = df, na.action = na.omit))
glm.nb(RECSHR ~ HOMELESS + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
hi <-glm.nb(RECSHR ~ HOMELESS + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(hi)
table(df$HOMELESS, df$RECSHR)
hello <- glm.nb(RECSHR ~ HOMELESS, data = df, na.action = na.omit)
summary(hello)
#homelessness
table(df$HOMELESS) #do you consider yourself homeless
table(df$MOSHOME, useNA = "ifany")
table(df$HOMELESS, useNA = "ifany")
table(df$YRSHOME, useNA = "ifany")
plot(df$MOSHOME)
plot(df$MOSHOME)
hist(df$MOSHOME)
? hist
hist(df$MOSHOME, plot=TRUE)
hist(df$YRSHOME, plot=TRUE)
summary(hi)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)
#REMOVING THE STIMULANT AND OPIATE INJECTION VARIABLES
model.nb.offset.reduced <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE  + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset.reduced)
model.nb.offset <- glm.nb(RECSHR ~ PUBINJ_3cat*HOMELESS + GENDER + AGE + ANYSTIM + ANYOPIATE + offset(log(df$SUMINJ)), data = df, na.action = na.omit)
summary(model.nb.offset)

setwd("~/Desktop/lizzyandshelley")
#set working directory
setwd("~/Desktop/lizzyandshelley") #LIZZY
#open packages
library(here)
library(foreign)
library(labelled)
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#load the data
df <- read.spss("Dataset", "Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#load the data
df <- read.spss(Dataset, "Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
setwd("~/Desktop/lizzyandshelley/Dataset")
#load the data
df <- read.spss("~/Desktop/lizzyandshelley/Dataset/"Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#set working directory
setwd("~/Desktop/lizzyandshelley/Dataset") #LIZZY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#set working directory
setwd("~/Desktop/lizzyandshelley/Dataset") #LIZZY
#open packages
library(here)
library(foreign)
library(labelled)
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
View(df.labels)
View(df.labels)
View(df.labels)
class(df.labels)
names(df.labels)
#set working directory
setwd("~/Desktop/lizzyandshelley/Dataset") #LIZZY
#open packages
library(here)
library(foreign)
library(labelled)
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
knitr::opts_chunk$set(echo = TRUE)
#open packages
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
knitr::opts_chunk$set(echo = TRUE)
#open packages
library(here)
library(foreign)
library(labelled)
library(dplyr)
library(reshape2)
library(lme4)
library(MASS)
#set working directory
setwd("~/Desktop/lizzyandshelley/Dataset") #LIZZY
#setwd("~/GitHub/lizzyandshelley/Dataset")  #SHELLEY
#load the data
df <- read.spss("Ricky.SAV", use.value.labels = TRUE, to.data.frame=TRUE)
#get variable labels
attr(df, "variable.labels")
df.labels <- as.data.frame(attr(df, "variable.labels"))
QDSlabels <- data.frame(rownames(df.labels))
df.labels <- cbind(QDSlabels, df.labels)
names(df.labels) <- c("VAR_ID", "description")
rm(QDSlabels)
#USE THIS CODE TO LOOK UP A VARIABLE DESCRIPTION
#df.labels$description[df.labels$VAR_ID=="GENDER"]
#clean up data types
df$MOSHOME <- as.numeric(df$MOSHOME)
df$MOSHOME1 <- as.numeric(df$MOSHOME1)
df$MOSHOME[is.na(df$MOSHOME)] <- 0
df$MOSHOME1[is.na(df$MOSHOME1)] <- 0
df$AGE <- as.numeric(df$AGE)
df$Rshare1 <- factor(df$Rshare1)
#commenting out because we may not be doing IPCW for the class project
#remove subjects with NA for key variables from the dataset
#df <- subset(df, SUBJECT!=4394)
#df <- subset(df, SUBJECT!=4457)
#df <- subset(df, SUBJECT!=5267)
#commenting out because we may not be doing IPCW for the class project
#reweight sample to address LTFU
#FIRST USE MICE TO IMPUTE COVARIATES
I_ABC <- df$FU1 == "Yes" & df$FU2 == 1
gFU1 <- glm(FU1 ~ Rshare + PUBINJ + HOMELESS + MOSHOME + IJWOTH + GENDER + AGE + RACELG, family = "binomial", data = df, na.action = na.omit)
gFU2 <- glm(FU2 ~ FU1 + Rshare + PUBINJ + HOMELESS + MOSHOME + IJWOTH + GENDER + AGE + RACELG, family = "binomial", data = df, na.action = na.omit)
df$pFU1 <- predict(gFU1, type = "response")
df$pFU2 <- predict(gFU2, type = "response")
df$w <- I_ABC/(df$pFU1 * df$pFU2)
rm(gFU1)
rm(gFU2)
#indicators, prob not needed
#df$I_A <- df$FU1 == "No" & df$FU2 == 0
#df$I_AB <- df$FU1 == "Yes" & df$FU2 == 0
#df$I_AC <- df$FU1 == "No" & df$FU2 == 1
#select people with no LTFU
#dfc <- subset(df, FU2==1 & FU1=="Yes")
#create key variables not asked at baseline
df$ARREST <- rep(NA)
df$POLICE <- rep(NA)
df$JAIL <- rep(NA)
#select variables, add "w" to the end of this if we do anything with weights
dfs <- df %>%
dplyr::select("SUBJECT", "GENDER", "AGE", "RACELG", "HOMELESS", "HOMELESS1", "HOMELESS2", "MOSHOME", "MOSHOME1", "MOSHOM2", "RECSHR", "RECSHR1", "RECSHR2", "PUBINJ", "PUBINJ1", "PUBINJ2", "IJWOTH", "IJWOTH1", "IJWOTH2",
"POLICE", "POLICE1", "POLICE2", "ARREST", "ARREST1", "ARREST2", "JAIL", "JAIL1", "JAIL2")
#make dataset long format
dfslong <- reshape(dfs, idvar = "SUBJECT", varying = list(c("HOMELESS", "HOMELESS1", "HOMELESS2"), c("MOSHOME", "MOSHOME1", "MOSHOM2"), c("RECSHR", "RECSHR1", "RECSHR2"), c("PUBINJ", "PUBINJ1", "PUBINJ2"), c("IJWOTH", "IJWOTH1", "IJWOTH2"), c("POLICE", "POLICE1", "POLICE2"), c("ARREST", "ARREST1", "ARREST2"), c("JAIL", "JAIL1", "JAIL2")), timevar = "VISIT", v.names = c("HOMELESS", "MOSHOME", "TIMESHARE", "PUBINJ", "IJWOTH", "POLICE", "ARREST", "JAIL"), ids = "SUBJECT", times = c("baseline", "FU1", "FU2"), direction = "long")
#update variable types
dfslong$TIMESHARE <- as.numeric(dfslong$TIMESHARE)
dfslong$POLICE <- as.factor(dfslong$POLICE)
dfslong$ARREST <- as.factor(dfslong$ARREST)
dfslong$JAIL <- as.factor(dfslong$JAIL)
dfslong$VISIT <- as.factor(dfslong$VISIT)
dfslong$MOSHOME <- as.numeric(dfslong$MOSHOME)
dfslong$PUBINJord <- as.numeric(ifelse(dfslong$PUBINJ=="Never (0% of the time)", 0, ifelse(dfslong$PUBINJ=="Occasionally (less than 25% of the time)", 1, ifelse(dfslong$PUBINJ=="Sometimes (25% to 74% of the time)", 2, ifelse(dfslong$PUBINJ=="Usually (75% to 99% of the time)", 3, ifelse(dfslong$PUBINJ=="Always (100% of the time)", 4 ,NA))))))
dfslong$IJWOTHord <- as.numeric(ifelse(dfslong$IJWOTH=="Never (0% of the time)", 0, ifelse(dfslong$IJWOTH=="Occasionally (less than 25% of the time)", 1, ifelse(dfslong$IJWOTH=="Sometimes (25% to 74% of the time)", 2, ifelse(dfslong$IJWOTH=="Usually (75% to 99% of the time)", 3, ifelse(dfslong$IJWOTH=="Always (100% of the time)", 4, NA))))))
dfslong$YRSHOME <- dfslong$MOSHOME/12
#gee model (no time-invariant covariates)
#NOTE THAT THIS CURRENTLY INCLUDES POLICE, ARREST, and JAIL - do we want to drop?? Mixed effects models don't include these (though could)
#Why is there no main effect of public injecting?
library(gee)
modelgee <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
summary(modelgee)
modelgee_timeinvariant <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
table(dfslong$GENDER)
table(dfslong$AGE)
table(dfslong$RACELG)
head(dfslong)
tail(dfslong)
dfslong[order(dfslong$SUBJECT),]
modelgee_timeinvariant <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvariant <- gee(TIMESHARE ~ PUBINJord + YRSHOME + HOMELESS + IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvariant <- gee(TIMESHARE ~ PUBINJord + YRSHOME + IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
length(unique(dfslong$SUBJECT))
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*IJWOTHord + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*IJWOTHord, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*IJWOTHord + GENDER, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*IJWOTHord + AGE, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_timeinvar <- gee(TIMESHARE ~ PUBINJord*IJWOTHord + RACELG, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
modelgee_minus_race <- gee(TIMESHARE ~ PUBINJord*YRSHOME + HOMELESS + PUBINJord*IJWOTHord + POLICE + ARREST + JAIL + GENDER + AGE, SUBJECT, data = dfslong, family = poisson, corstr = "exchangeable", na.action = na.omit)
